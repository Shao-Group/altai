# Overview

## **This project is in progress. It's not guaranteed to function properly.**

Altai (**Al**lele-specific **T**ranscript **A**ssembly **I**nstrument) is a reference-based allele-specific transcript assembler. It incorporates variations, e.g. SNPs in a vcf file, in the transcript assembly to assemble the full-length transcript sequences by assigning those variations to their correct phases, i.e. alleles. Its output transcript sequences are expected to be the actual allele-specific sequences rather than subsequences of the reference genome. Part of Altai is developed based on [Scallop](https://github.com/Kingsford-Group/scallop) ([license](https://github.com/Kingsford-Group/scallop/blob/master/LICENSE)).

In this repository, we host all source codes of Altai and an allele-specific transcriptome simulation pipeline ([Alsim](alsim)).

# Installation

Altai uses additional libraries of Boost, htslib, and Gurobi. If they have not been installed in your system, you first need to download and install them.

## Download Boost

If Boost has not been downloaded/installed, download Boost [(license)](http://www.boost.org/LICENSE_1_0.txt) from (www.boost.org).
Uncompress it somewhere (compiling and installing are not necessary).

## Install htslib

If htslib has not been installed, download htslib [(license)](https://github.com/samtools/htslib/blob/develop/LICENSE) from (www.htslib.org/) with version 1.5 or higher. Note that htslib relies on zlib. So if zlib has not been installed in your system, you need to install zlib first. 

Use the following commands to build htslib:

```sh
./configure --disable-bz2 --disable-lzma --disable-gcs --disable-s3 --enable-libcurl=no
make
make install
```

The default installation location of htslib is `/usr/lib`. If you would install it to a different location, replace the above `configure` line with the following (by adding `--prefix=/path/to/your/htslib` to the end):

```sh
./configure --disable-bz2 --disable-lzma --disable-gcs --disable-s3 --enable-libcurl=no --prefix=/path/to/your/htslib
```

In this case, you also need to export the runtime library path (note that there is an additional `lib` following the installation path):

```sh
export LD_LIBRARY_PATH=/path/to/your/htslib/lib:$LD_LIBRARY_PATH
```

## Install Gurobi Solver

Gurobi is an optimization solver. If Gurobi has not been installed, download Gurobi Optimizer and corresponding README.txt from (www.gurobi.com/downloads/) with version 9.1.1 or higher. Request a license as you need. [Academic license](https://www.gurobi.com/academia/academic-program-and-licenses/) is free. Follow the instructions to install Gurobi Optimizer and store the license file.

After installation, export Gurobi home directory and license file respectively to environment variable `GUROBI_HOME` and `GRB_LICENSE_FILE`. Also, add `$GUROBI_HOME/lib` to `LD_LIBRARY_PATH` and add `$GUROBI_HOME/bin`  to `PATH`:

```sh
export GUROBI_HOME=/path/to/Gurobi/dir/linux64
export GRB_LICENSE_FILE=/path/to/Gurobi/license/gurobi.lic
export LD_LIBRARY_PATH="$GUROBI_HOME/lib:$LD_LIBRARY_PATH"
export PATH="$GUROBI_HOME/bin:$PATH"
```

## Compile Altai

Use the following to compile Altai:

```sh
./configure --with-htslib=/path/to/your/htslib --with-boost=/path/to/your/boost
make
```

If some of the dependencies are installed in the default system directory (for example, `/usr/lib`),
then the corresponding `--with-` option might not be necessary. The executable file `altai` will appear at `src/altai`.

# Usage

## Quick start

The usage of `altai` is:

```sh
./altai -i <input.bam> -j <variants.vcf> [-G <genome.fa>] -o <output-prefix> [options]
```

If you would like to output the transcript sequences, `-G <genome.fa>` is necessary. Otherwise, it's optional.

The `input.bam` is the read alignment file generated by some RNA-seq aligner, (for example, TopHat2, STAR, or HISAT2).
Make sure the bam file is sorted; otherwise run `samtools` to sort it:

```sh
samtools sort input.bam > input.sort.bam
```

The `variants.vcf` is a variant calling format file generated by some variant caller from DNA or RNA, or downloaded from a database.

Make sure the vcf file is also sorted (with contigs in the same order as the bam file); otherwise run [bcftools](https://samtools.github.io/bcftools/bcftools.html) to sort it:

```sh
bcftools sort input.vcf > output.vcf
```

The reconstructed allele-specific transcripts shall be written as gvf format into `output-prefix.gvf`. Their sequences will be written as fasta format into `output-prefix.fa`. Note that **`altai` only outputs allele-specific transcripts**. If you want to have a complete allele-specific transcriptome with both allele-specific transcripts (two alleles different) and non-allele-specific transcripts (both alleles same), run the pipline below.

## Assemble an allele-specific transcriptome 

This is a complete pipeline of how to assemble an allele-specific transcriptome using Altai and a non-allele-specific transcript assembler (e.g. [Scallop](https://github.com/Kingsford-Group/scallop)).

## Identify allele-specifically differentially expressed  transcripts

After assembling an allele-specific transcriptome, users can obtain a `gvf` file and a `fasta` file. This 

although `altai` and `scallop` report a coverage value for every transcript, 

